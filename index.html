<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kontrol Palet Hanwa - Master & Stock</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1f2937;
            color: #f3f4f6;
        }
        .card {
            background-color: #374151;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .table-header {
            background-color: #4b5563;
        }
        /* Icon styles matching the uploaded image */
        .flag-icon { width: 1.25rem; height: 1.25rem; margin-right: 0.5rem; }
        .Kosong-color { color: #34d399; /* Green */ }
        .TerisiHanwa-color { color: #facc15; /* Yellow */ }
        .LuarPabrik-color { color: #f87171; /* Red */ }

        /* Custom Tab Styles */
        .tab {
            padding: 0.5rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }
        .tab:hover {
             background-color: #4b5563;
        }
        .tab.active {
            color: #3b82f6; /* Blue */
            border-bottom-color: #3b82f6;
            background-color: #374151;
        }
    </style>
</head>
<body>
    <div class="min-h-screen p-4 md:p-8">
        <!-- Header -->
        <header class="mb-4">
            <h1 class="text-3xl font-bold text-white">Kontrol Palet Hanwa</h1>
            <p class="text-gray-400" id="user-display">Memuat ID Pengguna...</p>
        </header>
        
        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-600 mb-6">
            <div id="tab-master-palet" class="tab active" onclick="switchTab('master-palet')">Master Palet</div>
            <div id="tab-stock-palet" class="tab" onclick="switchTab('stock-palet')">Stock Palet</div>
        </div>

        <!-- Tab Content: MASTER PALET -->
        <div id="content-master-palet" class="tab-content">
            <div class="card p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-300">Tambah Palet Baru</h2>
                <form id="add-palet-form" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="text" id="id-palet" placeholder="ID Palet (Ex: PSH01001)" required class="p-2 rounded bg-gray-600 border border-gray-500 text-white focus:ring-blue-500 focus:border-blue-500">
                    <input type="text" id="nama-palet" placeholder="Nama Palet (Ex: PALET SHARP)" required class="p-2 rounded bg-gray-600 border border-gray-500 text-white focus:ring-blue-500 focus:border-blue-500">
                    <input type="text" id="size-palet" placeholder="Size (Ex: 522.6 X 2395)" required class="p-2 rounded bg-gray-600 border border-gray-500 text-white focus:ring-blue-500 focus:border-blue-500">
                    
                    <select id="status-palet" required class="p-2 rounded bg-gray-600 border border-gray-500 text-white focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Pilih Status</option>
                        <option value="Kosong">Kosong</option>
                        <option value="Terisi">Terisi</option>
                    </select>
                    
                    <input type="text" id="lokasi-palet" placeholder="Lokasi (Ex: AREA PALET/AREA PRODUCT/CUSTOMER)" required class="p-2 rounded bg-gray-600 border border-gray-500 text-white focus:ring-blue-500 focus:border-blue-500">
                    
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-200">
                        <i class="fas fa-plus mr-2"></i> Tambah Palet
                    </button>
                </form>
                <div id="message-master" class="mt-3 hidden p-3 rounded text-sm"></div>
            </div>
            
            <div class="card p-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-300">Daftar Master Palet</h2>
                <div id="master-palet-table-container" class="overflow-x-auto">
                    <p class="text-center p-4 text-gray-400" id="loading-master">Memuat data master palet...</p>
                </div>
            </div>
        </div>

        <!-- Tab Content: STOCK PALET (Ringkasan Stok) -->
        <div id="content-stock-palet" class="tab-content hidden">
            <div class="card p-6">
                <h2 class="text-xl font-semibold mb-4 text-blue-400">Ringkasan Stok Palet (STOCK PALET)</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-600">
                        <thead class="table-header">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Nama Palet</th>
                                <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Size</th>
                                <th class="px-4 py-2 text-right text-xs font-medium uppercase tracking-wider">Kosong (Di Gudang)</th>
                                <th class="px-4 py-2 text-right text-xs font-medium uppercase tracking-wider">Terisi di HANWA (Area Prod)</th>
                                <th class="px-4 py-2 text-right text-xs font-medium uppercase tracking-wider">Di Luar Pabrik (Customer)</th>
                                <th class="px-4 py-2 text-right text-xs font-medium uppercase tracking-wider">Total</th>
                            </tr>
                        </thead>
                        <tbody id="stock-summary-body" class="divide-y divide-gray-700">
                            <tr>
                                <td colspan="6" class="p-4 text-center text-gray-400">Menunggu otentikasi...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Custom Modal for Confirmation/Alerts (to replace alert/confirm) -->
        <div id="custom-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
            <div class="bg-gray-800 p-6 rounded-lg shadow-xl w-96">
                <h3 id="modal-title" class="text-lg font-bold mb-4 text-white">Pesan</h3>
                <p id="modal-message" class="text-gray-300 mb-6"></p>
                <div class="flex justify-end space-x-3">
                    <button id="modal-cancel" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded hidden">Batal</button>
                    <button id="modal-confirm" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">OK</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, onSnapshot, doc, getDoc, setDoc, where, getDocs, updateDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('debug'); // Enable debug logging for Firestore

        let app;
        let db;
        let auth;
        let userId = null;
        let isAuthReady = false;

        // --- UTILITY: MODAL & MESSAGES ---
        const showModal = (title, message, isConfirm = false, onConfirm = () => {}, onCancel = () => {}) => {
            const modal = document.getElementById('custom-modal');
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-message').innerText = message;
            
            const confirmBtn = document.getElementById('modal-confirm');
            const cancelBtn = document.getElementById('modal-cancel');

            confirmBtn.onclick = () => { modal.classList.add('hidden'); onConfirm(); };
            
            if (isConfirm) {
                cancelBtn.classList.remove('hidden');
                cancelBtn.onclick = () => { modal.classList.add('hidden'); onCancel(); };
                confirmBtn.innerText = "Ya, Hapus";
            } else {
                cancelBtn.classList.add('hidden');
                confirmBtn.innerText = "OK";
            }

            modal.classList.remove('hidden');
        };
        
        const showMessage = (elementId, message, isError = false) => {
            const el = document.getElementById(elementId);
            el.innerText = message;
            el.classList.remove('hidden', 'bg-red-900/50', 'bg-green-900/50', 'text-red-300', 'text-green-300');
            if (isError) {
                el.classList.add('bg-red-900/50', 'text-red-300');
            } else {
                el.classList.add('bg-green-900/50', 'text-green-300');
            }
            setTimeout(() => { el.classList.add('hidden'); }, 5000);
        };

        // --- UTILITY: TAB SWITCHING ---
        window.switchTab = (tabName) => {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        };

        // --- FIREBASE DATA STRUCTURE & PATHS ---
        const MASTER_PALET_COLLECTION = 'masterPalets';
        const getMasterPaletPath = (uid) => 
            `/artifacts/${appId}/users/${uid}/${MASTER_PALET_COLLECTION}`;

        // --- INITIALIZATION & AUTH ---
        const initFirebase = async () => {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    showModal("Error", "Konfigurasi Firebase tidak ditemukan.", false);
                    document.getElementById('stock-summary-body').innerHTML = `<tr><td colspan="6" class="p-4 text-center text-red-400">ERROR: Konfigurasi Firebase hilang.</td></tr>`;
                    return;
                }

                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('user-display').innerText = `User ID: ${userId.substring(0, 10)}...`;
                        console.log("Authenticated with user ID:", userId);
                    } else {
                        userId = crypto.randomUUID(); 
                        document.getElementById('user-display').innerText = `Guest ID: ${userId.substring(0, 10)}...`;
                        console.log("Signed in anonymously. Using random UUID as identifier.");
                    }
                    isAuthReady = true;
                    setupListeners(); 
                });

            } catch (error) {
                console.error("Error initializing Firebase or signing in:", error);
                showModal("Error Otentikasi", `Gagal otentikasi. Detail: ${error.message}`, false);
            }
        };


        // --- STOCK PALET LOGIC ---
        
        /**
         * Mengubah data Master Palet (flat list) menjadi ringkasan stok (summary).
         * @param {Array<Object>} palets - Daftar semua dokumen palet.
         * @returns {Array<Object>} Ringkasan stok.
         */
        const createStockSummary = (palets) => {
            const summaryMap = {};

            palets.forEach(palet => {
                const key = `${palet.NamaPalet}|${palet.Size}`;
                
                if (!summaryMap[key]) {
                    summaryMap[key] = {
                        NamaPalet: palet.NamaPalet,
                        Size: palet.Size,
                        Kosong: 0,
                        TerisiHanwa: 0, 
                        LuarPabrik: 0, 
                        Total: 0
                    };
                }

                // Logika Ringkasan Stok (berdasarkan visual)
                if (palet.Status === 'Kosong') {
                    // Kosong (Di Gudang/Area Palet)
                    summaryMap[key].Kosong++;
                } else if (palet.Lokasi === 'AREA PRODUCT') {
                    // Terisi di HANWA (Area Prod)
                    summaryMap[key].TerisiHanwa++;
                } else if (palet.Lokasi === 'CUSTOMER' || palet.Lokasi === 'PIHAK KE-3') {
                    // Di Luar Pabrik (Customer/Pihak Ke-3)
                    summaryMap[key].LuarPabrik++;
                } else {
                    // Jika Status Terisi tapi Lokasi tidak jelas/belum terdefinisi
                    summaryMap[key].TerisiHanwa++;
                }

                summaryMap[key].Total++;
            });

            return Object.values(summaryMap);
        };
        
        /**
         * Merender tabel ringkasan stok palet.
         * @param {Array<Object>} summaryData - Data ringkasan stok.
         */
        const renderStockSummaryTable = (summaryData) => {
            const body = document.getElementById('stock-summary-body');
            if (!body) return;
            body.innerHTML = ''; 

            if (summaryData.length === 0) {
                body.innerHTML = `<tr><td colspan="6" class="p-4 text-center text-gray-400">Tidak ada data ringkasan palet.</td></tr>`;
                return;
            }

            summaryData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700 transition duration-150';
                
                row.innerHTML = `
                    <td class="px-4 py-2 whitespace-nowrap text-sm font-medium">${item.NamaPalet}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-400">${item.Size}</td>
                    
                    <!-- KOSONG (Green Flag) -->
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-right font-semibold">
                        <span class="Kosong-color"><i class="fas fa-flag flag-icon"></i>${item.Kosong}</span>
                    </td>
                    
                    <!-- TERISI DI HANWA (Yellow Flag) -->
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-right font-semibold">
                        <span class="TerisiHanwa-color"><i class="fas fa-flag flag-icon"></i>${item.TerisiHanwa}</span>
                    </td>
                    
                    <!-- DI LUAR PABRIK (Red Flag) -->
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-right font-semibold">
                        <span class="LuarPabrik-color"><i class="fas fa-flag flag-icon"></i>${item.LuarPabrik}</span>
                    </td>
                    
                    <!-- TOTAL -->
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-right font-bold text-white">${item.Total}</td>
                `;
                body.appendChild(row);
            });
        };


        // --- MASTER PALET LOGIC ---

        /**
         * Merender tabel detail master palet.
         * @param {Array<Object>} palets - Daftar semua dokumen palet.
         */
        const renderMasterPaletTable = (palets) => {
            const container = document.getElementById('master-palet-table-container');
            const loading = document.getElementById('loading-master');
            if (loading) loading.remove();

            if (palets.length === 0) {
                container.innerHTML = `<p class="text-center p-4 text-gray-400">Tidak ada data master palet. Silakan tambahkan palet baru.</p>`;
                return;
            }

            let tableHTML = `
                <table class="min-w-full divide-y divide-gray-600">
                    <thead class="table-header">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Nama Palet</th>
                            <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">ID Palet</th>
                            <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Size</th>
                            <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Status</th>
                            <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Lokasi</th>
                            <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Tgl Update</th>
                            <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Aksi</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-700">
            `;

            palets.forEach(p => {
                let statusColor = '';
                if (p.Status === 'Kosong') {
                    statusColor = 'text-green-400';
                } else if (p.Lokasi === 'AREA PRODUCT' || p.Lokasi === 'AREA PALET') {
                    statusColor = 'text-yellow-400';
                } else if (p.Lokasi === 'CUSTOMER' || p.Lokasi === 'PIHAK KE-3') {
                    statusColor = 'text-red-400';
                }

                tableHTML += `
                    <tr class="hover:bg-gray-700 transition duration-150">
                        <td class="px-4 py-2 whitespace-nowrap text-sm font-medium">${p.NamaPalet}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-300">${p.IDPalet}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-400">${p.Size}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm font-semibold ${statusColor}">${p.Status}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-400">${p.Lokasi}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-400">${p.TanggalUpdate || 'N/A'}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm">
                            <button onclick="handleDeletePalet('${p.id}', '${p.IDPalet}')" class="text-red-500 hover:text-red-700 mr-2" title="Hapus Palet"><i class="fas fa-trash-alt"></i></button>
                            <!-- Tambahkan tombol Edit di masa depan -->
                        </td>
                    </tr>
                `;
            });

            tableHTML += `</tbody></table>`;
            container.innerHTML = tableHTML;
        };
        
        // --- ADD PALET HANDLER ---
        const handleAddPalet = async (e) => {
            e.preventDefault();
            
            if (!isAuthReady || !db || !userId) {
                showMessage('message-master', 'Otentikasi belum siap. Silakan tunggu.', true);
                return;
            }

            const IDPalet = document.getElementById('id-palet').value.trim().toUpperCase();
            const NamaPalet = document.getElementById('nama-palet').value.trim().toUpperCase();
            const Size = document.getElementById('size-palet').value.trim();
            const Status = document.getElementById('status-palet').value;
            const Lokasi = document.getElementById('lokasi-palet').value.trim().toUpperCase();

            if (!IDPalet || !NamaPalet || !Size || !Status || !Lokasi) {
                showMessage('message-master', 'Semua field wajib diisi.', true);
                return;
            }

            try {
                const paletRef = doc(db, getMasterPaletPath(userId), IDPalet);
                const docSnap = await getDoc(paletRef);

                if (docSnap.exists()) {
                    showMessage('message-master', `ID Palet ${IDPalet} sudah ada di database. Gunakan ID unik.`, true);
                    return;
                }

                const newPalet = {
                    IDPalet,
                    NamaPalet,
                    Size,
                    Status,
                    Lokasi,
                    TanggalUpdate: new Date().toLocaleDateString('en-US'),
                    JumlahDigunakan: 0, // Placeholder for future usage tracking
                    Keterangan: '' 
                };

                await setDoc(paletRef, newPalet);
                showMessage('message-master', `Palet ${IDPalet} berhasil ditambahkan!`, false);
                document.getElementById('add-palet-form').reset();

            } catch (error) {
                console.error("Error adding palet:", error);
                showMessage('message-master', `Gagal menyimpan Palet. Cek konsol untuk detail.`, true);
            }
        };
        
        // --- DELETE PALET HANDLER ---
        window.handleDeletePalet = (docId, IDPalet) => {
            if (!isAuthReady || !db || !userId) {
                showModal("Error", "Otentikasi belum siap. Silakan tunggu.", false);
                return;
            }

            const onConfirm = async () => {
                try {
                    const paletRef = doc(db, getMasterPaletPath(userId), docId);
                    await deleteDoc(paletRef);
                    showMessage('message-master', `Palet ${IDPalet} berhasil dihapus.`, false);
                } catch (error) {
                    console.error("Error deleting palet:", error);
                    showModal("Error Hapus", `Gagal menghapus Palet ${IDPalet}. Cek konsol.`, false);
                }
            };

            showModal("Konfirmasi Hapus", `Apakah Anda yakin ingin menghapus Palet ${IDPalet}? Tindakan ini tidak dapat dibatalkan.`, true, onConfirm);
        };
        
        // Attach form listener
        document.getElementById('add-palet-form').addEventListener('submit', handleAddPalet);


        // --- FIRESTORE LISTENERS ---
        const setupListeners = () => {
            if (!isAuthReady || !db || !userId) return;

            const collectionPath = getMasterPaletPath(userId);
            const q = query(collection(db, collectionPath));
            
            console.log(`Listening to collection: ${collectionPath}`);

            onSnapshot(q, (querySnapshot) => {
                const palets = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    // Firestore ID is used as the document ID for deletion
                    palets.push({ id: doc.id, ...data }); 
                });

                // 1. Render Master Palet Detail Table
                renderMasterPaletTable(palets);

                // 2. Process and Render Stock Summary Card (STOCK PALET Menu)
                const summaryData = createStockSummary(palets);
                renderStockSummaryTable(summaryData);

            }, (error) => {
                console.error("Error getting master palet documents: ", error);
                document.getElementById('stock-summary-body').innerHTML = `<tr><td colspan="6" class="p-4 text-center text-red-400">ERROR: Gagal memuat data Ringkasan Stok.</td></tr>`;
                document.getElementById('master-palet-table-container').innerHTML = `<p class="text-center p-4 text-red-400">ERROR: Gagal memuat data Master Palet.</p>`;
            });
        };

        // --- INITIAL DATA SEEDING (FOR DEMO/TESTING) ---
        const seedDataIfNeeded = async () => {
             if (!isAuthReady || !db || !userId) return;
             const collectionRef = collection(db, getMasterPaletPath(userId));
             
             // Check if data exists (only checking one known document)
             const docRef = doc(collectionRef, 'PSH01001');
             const docSnap = await getDoc(docRef);

             if (!docSnap.exists()) {
                 console.log("Seeding initial data...");
                 const batch = writeBatch(db);
                 const date = new Date().toLocaleDateString('en-US');

                 // Data 1: PALET SHARP 522.6 X 2395 (Total 12)
                 const palet1Data = [
                    // Kosong (Di Gudang) (9 units)
                    { id: 'PSH01001', status: 'Kosong', lokasi: 'AREA PALET' }, { id: 'PSH01002', status: 'Kosong', lokasi: 'AREA PALET' },
                    { id: 'PSH01003', status: 'Kosong', lokasi: 'AREA PALET' }, { id: 'PSH01004', status: 'Kosong', lokasi: 'AREA PALET' },
                    { id: 'PSH01005', status: 'Kosong', lokasi: 'AREA PALET' }, { id: 'PSH01006', status: 'Kosong', lokasi: 'AREA PALET' },
                    { id: 'PSH01007', status: 'Kosong', lokasi: 'AREA PALET' }, { id: 'PSH01008', status: 'Kosong', lokasi: 'AREA PALET' },
                    { id: 'PSH01009', status: 'Kosong', lokasi: 'AREA PALET' },
                    // Terisi di HANWA (Area Product) (2 units)
                    { id: 'PSH01010', status: 'Terisi', lokasi: 'AREA PRODUCT' }, { id: 'PSH01011', status: 'Terisi', lokasi: 'AREA PRODUCT' },
                    // Di Luar Pabrik (Customer) (1 unit)
                    { id: 'PSH01012', status: 'Terisi', lokasi: 'CUSTOMER' },
                 ];

                 palet1Data.forEach(p => {
                    batch.set(doc(collectionRef, p.id), { 
                        IDPalet: p.id,
                        NamaPalet: 'PALET SHARP', 
                        Size: '522.6 X 2395',
                        Status: p.status,
                        Lokasi: p.lokasi,
                        TanggalUpdate: date,
                        JumlahDigunakan: 0,
                        Keterangan: '' 
                    });
                 });
                 
                 // Data 2: PALET SHARP 522.6 X 2685 (Total 7)
                 for (let i = 1; i <= 7; i++) {
                     const id = `PSH0200${i}`;
                     batch.set(doc(collectionRef, id), { 
                         IDPalet: id,
                         NamaPalet: 'PALET SHARP', 
                         Size: '522.6 X 2685',
                         Status: 'Kosong',
                         Lokasi: 'AREA PALET', 
                         TanggalUpdate: date,
                         JumlahDigunakan: 0,
                         Keterangan: '' 
                     });
                 }

                 await batch.commit();
                 console.log("Initial data seeded successfully.");
             }
        };

        // --- MAIN EXECUTION ---
        window.onload = async () => {
            await initFirebase();
            
            // Wait briefly for auth to complete before seeding data
            const checkAuth = setInterval(async () => {
                if (isAuthReady) {
                    clearInterval(checkAuth);
                    // Seed data only runs if the collection is empty
                    await seedDataIfNeeded(); 
                }
            }, 100);
        };
    </script>

</body>
</html>
